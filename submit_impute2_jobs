#!/usr/bin/env perl

use warnings;
use strict;
use autodie;
use feature qw/ say /;
use Carp;
use Getopt::Long;

#Submit impute2 jobs for all files matching .*chr(\d+).phased.haps in the current directory using 5 megabase (MB) chunks.

my $CHUNKS = { #Define a hash reference for chromosomes 1-22 and X. Let each element be a reference to an array of chunks, each of which is a reference to a two-element array containing the interval's coordinates.
	      'chr1'  => [ #chr1 in hg19 contains 249,250,621 basepairs (249.250621MB), of which 46 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 55000000] ,
			  [55000001 , 60000000] ,
			  [60000001 , 65000000] ,
			  [65000001 , 70000000] ,
			  [70000001 , 75000000] ,
			  [75000001 , 80000000] ,
			  [80000001 , 85000000] ,
			  [85000001 , 90000000] ,
			  [90000001 , 95000000] ,
			  [95000001 , 100000000] ,
			  [100000001 , 105000000] ,
			  [105000001 , 110000000] ,
			  [110000001 , 115000000] ,
			  [115000001 , 120000000] ,
			  [120000001 , 124300000] ,
			  [144300001 , 149300000] ,
			  [149300001 , 154300000] ,
			  [154300001 , 159300000] ,
			  [159300001 , 164300000] ,
			  [164300001 , 169300000] ,
			  [169300001 , 174300000] ,
			  [174300001 , 179300000] ,
			  [179300001 , 184300000] ,
			  [184300001 , 189300000] ,
			  [189300001 , 194300000] ,
			  [194300001 , 199300000] ,
			  [199300001 , 204300000] ,
			  [204300001 , 209300000] ,
			  [209300001 , 214300000] ,
			  [214300001 , 219300000] ,
			  [219300001 , 224300000] ,
			  [224300001 , 229300000] ,
			  [229300001 , 234300000] ,
			  [234300001 , 239300000] ,
			  [239300001 , 244300000] ,
			  [244300001 , 249250621] ] ,
	      'chr2'  => [ #chr2 in hg19 contains 243,199,373 basepairs (243.199373MB), of which 49 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 55000000] ,
			  [55000001 , 60000000] ,
			  [60000001 , 65000000] ,
			  [65000001 , 70000000] ,
			  [70000001 , 75000000] ,
			  [75000001 , 80000000] ,
			  [80000001 , 85000000] ,
			  [85000001 , 90000000] ,
			  [90000001 , 93300000] ,
			  [93300001 , 98300000] ,
			  [98300001 , 103300000] ,
			  [103300001 , 108300000] ,
			  [108300001 , 113300000] ,
			  [113300001 , 118300000] ,
			  [118300001 , 123300000] ,
			  [123300001 , 128300000] ,
			  [128300001 , 133300000] ,
			  [133300001 , 138300000] ,
			  [138300001 , 143300000] ,
			  [143300001 , 148300000] ,
			  [148300001 , 153300000] ,
			  [153300001 , 158300000] ,
			  [158300001 , 163300000] ,
			  [163300001 , 168300000] ,
			  [168300001 , 173300000] ,
			  [173300001 , 178300000] ,
			  [178300001 , 183300000] ,
			  [183300001 , 188300000] ,
			  [188300001 , 193300000] ,
			  [193300001 , 198300000] ,
			  [198300001 , 203300000] ,
			  [203300001 , 208300000] ,
			  [208300001 , 213300000] ,
			  [213300001 , 218300000] ,
			  [218300001 , 223300000] ,
			  [223300001 , 228300000] ,
			  [228300001 , 233300000] ,
			  [233300001 , 238300000] ,
			  [238300001 , 243199373] ] ,
	      'chr3'  => [ #chr3 in hg19 contains 198,022,430 basepairs (198.02243MB), of which 41 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 55000000] ,
			  [55000001 , 60000000] ,
			  [60000001 , 65000000] ,
			  [65000001 , 70000000] ,
			  [70000001 , 75000000] ,
			  [75000001 , 80000000] ,
			  [80000001 , 85000000] ,
			  [85000001 , 90000000] ,
			  [90000001 , 91700000] ,
			  [91700001 , 96700000] ,
			  [96700001 , 101700000] ,
			  [101700001 , 106700000] ,
			  [106700001 , 111700000] ,
			  [111700001 , 116700000] ,
			  [116700001 , 121700000] ,
			  [121700001 , 126700000] ,
			  [126700001 , 131700000] ,
			  [131700001 , 136700000] ,
			  [136700001 , 141700000] ,
			  [141700001 , 146700000] ,
			  [146700001 , 151700000] ,
			  [151700001 , 156700000] ,
			  [156700001 , 161700000] ,
			  [161700001 , 166700000] ,
			  [166700001 , 171700000] ,
			  [171700001 , 176700000] ,
			  [176700001 , 181700000] ,
			  [181700001 , 186700000] ,
			  [186700001 , 191700000] ,
			  [191700001 , 196700000] ,
			  [196700001 , 198022430] ] ,
	      'chr4'  => [ #chr4 in hg19 contains 191,154,276 basepairs (191.154276MB), of which 39 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50700001 , 55700000] ,
			  [55700001 , 60700000] ,
			  [60700001 , 65700000] ,
			  [65700001 , 70700000] ,
			  [70700001 , 75700000] ,
			  [75700001 , 80700000] ,
			  [80700001 , 85700000] ,
			  [85700001 , 90700000] ,
			  [90700001 , 95700000] ,
			  [95700001 , 100700000] ,
			  [100700001 , 105700000] ,
			  [105700001 , 110700000] ,
			  [110700001 , 115700000] ,
			  [115700001 , 120700000] ,
			  [120700001 , 125700000] ,
			  [125700001 , 130700000] ,
			  [130700001 , 135700000] ,
			  [135700001 , 140700000] ,
			  [140700001 , 145700000] ,
			  [145700001 , 150700000] ,
			  [150700001 , 155700000] ,
			  [155700001 , 160700000] ,
			  [160700001 , 165700000] ,
			  [165700001 , 170700000] ,
			  [170700001 , 175700000] ,
			  [175700001 , 180700000] ,
			  [180700001 , 185700000] ,
			  [185700001 , 190700000] ,
			  [190700001 , 191154276] ] ,
	      'chr5'  => [ #chr5 in hg19 contains 180,915,260 basepairs (180.91526MB), of which 37 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 47700000] ,
			  [47700001 , 52700000] ,
			  [52700001 , 57700000] ,
			  [57700001 , 62700000] ,
			  [62700001 , 67700000] ,
			  [67700001 , 72700000] ,
			  [72700001 , 77700000] ,
			  [77700001 , 82700000] ,
			  [82700001 , 87700000] ,
			  [87700001 , 92700000] ,
			  [92700001 , 97700000] ,
			  [97700001 , 102700000] ,
			  [102700001 , 107700000] ,
			  [107700001 , 112700000] ,
			  [112700001 , 117700000] ,
			  [117700001 , 122700000] ,
			  [122700001 , 127700000] ,
			  [127700001 , 132700000] ,
			  [132700001 , 137700000] ,
			  [137700001 , 142700000] ,
			  [142700001 , 147700000] ,
			  [147700001 , 152700000] ,
			  [152700001 , 157700000] ,
			  [157700001 , 162700000] ,
			  [162700001 , 167700000] ,
			  [167700001 , 172700000] ,
			  [172700001 , 177700000] ,
			  [177700001 , 180915260] ] ,
	      'chr6'  => [ #chr6 in hg19 contains 171,115,067 basepairs (171.115067MB), of which 35 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 55000000] ,
			  [55000001 , 60000000] ,
			  [60500001 , 65500000] ,
			  [65500001 , 70500000] ,
			  [70500001 , 75500000] ,
			  [75500001 , 80500000] ,
			  [80500001 , 85500000] ,
			  [85500001 , 90500000] ,
			  [90500001 , 95500000] ,
			  [95500001 , 100500000] ,
			  [100500001 , 105500000] ,
			  [105500001 , 110500000] ,
			  [110500001 , 115500000] ,
			  [115500001 , 120500000] ,
			  [120500001 , 125500000] ,
			  [125500001 , 130500000] ,
			  [130500001 , 135500000] ,
			  [135500001 , 140500000] ,
			  [140500001 , 145500000] ,
			  [145500001 , 150500000] ,
			  [150500001 , 155500000] ,
			  [155500001 , 160500000] ,
			  [160500001 , 165500000] ,
			  [165500001 , 170500000] ,
			  [170500001 , 171115067] ] ,
	      'chr7'  => [ #chr7 in hg19 contains 159,138,663 basepairs (159.138663MB), of which 33 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 55000000] ,
			  [55000001 , 59100000] ,
			  [59100001 , 64100000] ,
			  [64100001 , 69100000] ,
			  [69100001 , 74100000] ,
			  [74100001 , 79100000] ,
			  [79100001 , 84100000] ,
			  [84100001 , 89100000] ,
			  [89100001 , 94100000] ,
			  [94100001 , 99100000] ,
			  [99100001 , 104100000] ,
			  [104100001 , 109100000] ,
			  [109100001 , 114100000] ,
			  [114100001 , 119100000] ,
			  [119100001 , 124100000] ,
			  [124100001 , 129100000] ,
			  [129100001 , 134100000] ,
			  [134100001 , 139100000] ,
			  [139100001 , 144100000] ,
			  [144100001 , 149100000] ,
			  [149100001 , 154100000] ,
			  [154100001 , 159100000] ,
			  [159100001 , 159138663] ] ,
	      'chr8'  => [ #chr8 in hg19 contains 146,364,022 basepairs (146.364022MB), of which 30 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45200001 , 50200000] ,
			  [50200001 , 55200000] ,
			  [55200001 , 60200000] ,
			  [60200001 , 65200000] ,
			  [65200001 , 70200000] ,
			  [70200001 , 75200000] ,
			  [75200001 , 80200000] ,
			  [80200001 , 85200000] ,
			  [85200001 , 90200000] ,
			  [90200001 , 95200000] ,
			  [95200001 , 100200000] ,
			  [100200001 , 105200000] ,
			  [105200001 , 110200000] ,
			  [110200001 , 115200000] ,
			  [115200001 , 120200000] ,
			  [120200001 , 125200000] ,
			  [125200001 , 130200000] ,
			  [130200001 , 135200000] ,
			  [135200001 , 140200000] ,
			  [140200001 , 145200000] ,
			  [145200001 , 146364022] ] ,
	      'chr9'  => [ #chr9 in hg19 contains 141,213,431 basepairs (141.213431MB), of which 24 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [66800001 , 71800000] ,
			  [71800001 , 76800000] ,
			  [76800001 , 81800000] ,
			  [81800001 , 86800000] ,
			  [86800001 , 91800000] ,
			  [91800001 , 96800000] ,
			  [96800001 , 101800000] ,
			  [101800001 , 106800000] ,
			  [106800001 , 111800000] ,
			  [111800001 , 116800000] ,
			  [116800001 , 121800000] ,
			  [121800001 , 126800000] ,
			  [126800001 , 131800000] ,
			  [131800001 , 136800000] ,
			  [136800001 , 141213431] ] ,
	      'chr10' => [ #chr10 in hg19 contains 135,534,747 basepairs (135.534747MB), of which 28 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40300001 , 45300000] ,
			  [45300001 , 50300000] ,
			  [50300001 , 55300000] ,
			  [55300001 , 60300000] ,
			  [60300001 , 65300000] ,
			  [65300001 , 70300000] ,
			  [70300001 , 75300000] ,
			  [75300001 , 80300000] ,
			  [80300001 , 85300000] ,
			  [85300001 , 90300000] ,
			  [90300001 , 95300000] ,
			  [95300001 , 100300000] ,
			  [100300001 , 105300000] ,
			  [105300001 , 110300000] ,
			  [110300001 , 115300000] ,
			  [115300001 , 120300000] ,
			  [120300001 , 125300000] ,
			  [125300001 , 130300000] ,
			  [130300001 , 135300000] ,
			  [135300001 , 135534747] ] ,
	      'chr11' => [ #chr11 in hg19 contains 135,006,516 basepairs (135.006516MB), of which 28 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 40000000] ,
			  [40000001 , 45000000] ,
			  [45000001 , 50000000] ,
			  [50000001 , 52900000] ,
			  [52900001 , 57900000] ,
			  [57900001 , 62900000] ,
			  [62900001 , 67900000] ,
			  [67900001 , 72900000] ,
			  [72900001 , 77900000] ,
			  [77900001 , 82900000] ,
			  [82900001 , 87900000] ,
			  [87900001 , 92900000] ,
			  [92900001 , 97900000] ,
			  [97900001 , 102900000] ,
			  [102900001 , 107900000] ,
			  [107900001 , 112900000] ,
			  [112900001 , 117900000] ,
			  [117900001 , 122900000] ,
			  [122900001 , 127900000] ,
			  [127900001 , 132900000] ,
			  [132900001 , 135006516] ] ,
	      'chr12' => [ #chr12 in hg19 contains 133,851,895 basepairs (133.851895MB), of which 27 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35400001 , 40400000] ,
			  [40400001 , 45400000] ,
			  [45400001 , 50400000] ,
			  [50400001 , 55400000] ,
			  [55400001 , 60400000] ,
			  [60400001 , 65400000] ,
			  [65400001 , 70400000] ,
			  [70400001 , 75400000] ,
			  [75400001 , 80400000] ,
			  [80400001 , 85400000] ,
			  [85400001 , 90400000] ,
			  [90400001 , 95400000] ,
			  [95400001 , 100400000] ,
			  [100400001 , 105400000] ,
			  [105400001 , 110400000] ,
			  [110400001 , 115400000] ,
			  [115400001 , 120400000] ,
			  [120400001 , 125400000] ,
			  [125400001 , 130400000] ,
			  [130400001 , 133851895] ] ,
	      'chr13' => [ #chr13 in hg19 contains 115,169,878 basepairs (115.169878MB), of which 20 5MB chunks are used.
			  [16000001 , 21000000] ,
			  [21000001 , 26000000] ,
			  [26000001 , 31000000] ,
			  [31000001 , 36000000] ,
			  [36000001 , 41000000] ,
			  [41000001 , 46000000] ,
			  [46000001 , 51000000] ,
			  [51000001 , 56000000] ,
			  [56000001 , 61000000] ,
			  [61000001 , 66000000] ,
			  [66000001 , 71000000] ,
			  [71000001 , 76000000] ,
			  [76000001 , 81000000] ,
			  [81000001 , 86000000] ,
			  [86000001 , 91000000] ,
			  [91000001 , 96000000] ,
			  [96000001 , 101000000] ,
			  [101000001 , 106000000] ,
			  [106000001 , 111000000] ,
			  [111000001 , 115169878] ] ,
	      'chr14' => [ #chr14 in hg19 contains 107,349,540 basepairs (107.34954MB), of which 19 5MB chunks are used.
			  [15600001 , 20600000] ,
			  [20600001 , 25600000] ,
			  [25600001 , 30600000] ,
			  [30600001 , 35600000] ,
			  [35600001 , 40600000] ,
			  [40600001 , 45600000] ,
			  [45600001 , 50600000] ,
			  [50600001 , 55600000] ,
			  [55600001 , 60600000] ,
			  [60600001 , 65600000] ,
			  [65600001 , 70600000] ,
			  [70600001 , 75600000] ,
			  [75600001 , 80600000] ,
			  [80600001 , 85600000] ,
			  [85600001 , 90600000] ,
			  [90600001 , 95600000] ,
			  [95600001 , 100600000] ,
			  [100600001 , 105600000] ,
			  [105600001 , 107349540] ] ,
	      'chr15' => [ #chr15 in hg19 contains 102,531,392 basepairs (102.531392MB), of which 18 5MB chunks are used.
			  [17000001 , 22000000] ,
			  [22000001 , 27000000] ,
			  [27000001 , 32000000] ,
			  [32000001 , 37000000] ,
			  [37000001 , 42000000] ,
			  [42000001 , 47000000] ,
			  [47000001 , 52000000] ,
			  [52000001 , 57000000] ,
			  [57000001 , 62000000] ,
			  [62000001 , 67000000] ,
			  [67000001 , 72000000] ,
			  [72000001 , 77000000] ,
			  [77000001 , 82000000] ,
			  [82000001 , 87000000] ,
			  [87000001 , 92000000] ,
			  [92000001 , 97000000] ,
			  [97000001 , 102000000] ,
			  [102000001 , 102531392] ] ,
	      'chr16' => [ #chr16 in hg19 contains 90,354,753 basepairs (90.354753MB), of which 18 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 30000000] ,
			  [30000001 , 35000000] ,
			  [35000001 , 38200000] ,
			  [43200001 , 48200000] ,
			  [48200001 , 53200000] ,
			  [53200001 , 58200000] ,
			  [58200001 , 63200000] ,
			  [63200001 , 68200000] ,
			  [68200001 , 73200000] ,
			  [73200001 , 78200000] ,
			  [78200001 , 83200000] ,
			  [83200001 , 88200000] ,
			  [88200001 , 90354753] ] ,
	      'chr17' => [ #chr17 in hg19 contains 81,195,210 basepairs (81.19521MB), of which 17 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 22200000] ,
			  [22200001 , 27200000] ,
			  [27200001 , 32200000] ,
			  [32200001 , 37200000] ,
			  [37200001 , 42200000] ,
			  [42200001 , 47200000] ,
			  [47200001 , 52200000] ,
			  [52200001 , 57200000] ,
			  [57200001 , 62200000] ,
			  [62200001 , 67200000] ,
			  [67200001 , 72200000] ,
			  [72200001 , 77200000] ,
			  [77200001 , 81195210] ] ,
	      'chr18' => [ #chr18 in hg19 contains 78,077,248 basepairs (78.077248MB), of which 17 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 16100000] ,
			  [16100001 , 21100000] ,
			  [21100001 , 26100000] ,
			  [26100001 , 31100000] ,
			  [31100001 , 36100000] ,
			  [36100001 , 41100000] ,
			  [41100001 , 46100000] ,
			  [46100001 , 51100000] ,
			  [51100001 , 56100000] ,
			  [56100001 , 61100000] ,
			  [61100001 , 66100000] ,
			  [66100001 , 71100000] ,
			  [71100001 , 76100000] ,
			  [76100001 , 78077248] ] ,
	      'chr19' => [ #chr19 in hg19 contains 59,128,983 basepairs (59.128983MB), of which 13 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 28500000] ,
			  [28500001 , 33500000] ,
			  [33500001 , 38500000] ,
			  [38500001 , 43500000] ,
			  [43500001 , 48500000] ,
			  [48500001 , 53500000] ,
			  [53500001 , 58500000] ,
			  [58500001 , 59128983] ] ,
	      'chr20' => [ #chr20 in hg19 contains 63,025,520 basepairs (63.02552MB), of which 14 5MB chunks are used.
			  [1 , 5000000] ,
			  [5000001 , 10000000] ,
			  [10000001 , 15000000] ,
			  [15000001 , 20000000] ,
			  [20000001 , 25000000] ,
			  [25000001 , 27100000] ,
			  [27100001 , 32100000] ,
			  [32100001 , 37100000] ,
			  [37100001 , 42100000] ,
			  [42100001 , 47100000] ,
			  [47100001 , 52100000] ,
			  [52100001 , 57100000] ,
			  [57100001 , 62100000] ,
			  [62100001 , 63025520] ] ,
	      'chr21' => [ #chr21 in hg19 contains 48,129,895 basepairs (48.129895MB), of which 9 5MB chunks are used.
			  [10000001 , 12300000] ,
			  [12300001 , 17300000] ,
			  [17300001 , 22300000] ,
			  [22300001 , 27300000] ,
			  [27300001 , 32300000] ,
			  [32300001 , 37300000] ,
			  [37300001 , 42300000] ,
			  [42300001 , 47300000] ,
			  [47300001 , 48129895] ] ,
	      'chr22' => [ #chr22 in hg19 contains 51,304,566 basepairs (51.304566MB), of which 7 5MB chunks are used.
			  [16800001 , 21800000] ,
			  [21800001 , 26800000] ,
			  [26800001 , 31800000] ,
			  [31800001 , 36800000] ,
			  [36800001 , 41800000] ,
			  [41800001 , 46800000] ,
			  [46800001 , 51304566] ] ,
	      'chrX_nonPAR' => [ #chrX_nonPAR in hg19 contains 154,931,043 basepairs (154.931043MB), of which 33 5MB chunks are used.
				[1 , 60000] ,
				[2699521 , 5000000] ,
				[5000001 , 10000000] ,
				[10000001 , 15000000] ,
				[15000001 , 20000000] ,
				[20000001 , 25000000] ,
				[25000001 , 30000000] ,
				[30000001 , 35000000] ,
				[35000001 , 40000000] ,
				[40000001 , 45000000] ,
				[45000001 , 50000000] ,
				[50000001 , 55000000] ,
				[55000001 , 59500000] ,
				[59500001 , 64500000] ,
				[64500001 , 69500000] ,
				[69500001 , 74500000] ,
				[74500001 , 79500000] ,
				[79500001 , 84500000] ,
				[84500001 , 89500000] ,
				[89500001 , 94500000] ,
				[94500001 , 99500000] ,
				[99500001 , 104500000] ,
				[104500001 , 109500000] ,
				[109500001 , 114500000] ,
				[114500001 , 119500000] ,
				[119500001 , 124500000] ,
				[124500001 , 129500000] ,
				[129500001 , 134500000] ,
				[134500001 , 139500000] ,
				[139500001 , 144500000] ,
				[144500001 , 149500000] ,
				[149500001 , 154500000] ,
				[154500001 , 154931043] ] ,
	      'chrX_PAR1' => [ #The first pseudoautosomal region is just 1 chunk:
			      [60001 , 2699520] ] ,
	      'chrX_PAR2' => [ #...And ditto the second PAR:
			      [154931044 , 155270560] ] ,
}; #End of CHUNKS data structure.

my @chromosomes = ( 1 .. 22 , 'X_nonPAR' , 'X_PAR1' , 'X_PAR2' );
my @ref_map_files = map { '/home/colebr/data/1000GP_Phase3/genetic_map_chr'   . $_ . '_combined_b37.txt' } @chromosomes;
my @hap_files     = map { '/home/colebr/data/1000GP_Phase3/1000GP_Phase3_chr' . $_ . '_hap.gz'           } @chromosomes;
my @legend_files  = map { '/home/colebr/data/1000GP_phase3/1000GP_Phase3_chr' . $_ . '_legend.gz'        } @chromosomes;

sub get_phased_haps_files {
  #my $phased_haps_files = get_phased_haps_files();
  my $glob_expression = '*chr*.phased.haps';
  my @hits = glob('*chr*.phased.haps');
  croak "Failed to collect phased haps files using the glob expression *chr*.phased.haps so dying with shame\n" unless scalar @hits >= 1;
  return \@hits;
}

sub get_chromosome_from_file_name {
  #my $chromosome = get_chromosome_from_file_name( $phased_haps_file_name );
  my $file_name = shift;
  $file_name =~ /.*(chr[1-9XYM]{1,2})\.phased\.haps/;
  croak "Failed to extract a chromosome number from the file name $file_name so dying with shame\n" unless $file_name;
  return $1; #Return the referenced named capture.
}

sub main {
  #1. Collect input directory and output directory.  Create output directory if it doesn't exist.
  my $usage = "./submit_impute2_jobs input_dir output_dir\n"; #TODO add options, e.g. for memory.
  die $usage unless @ARGV == 2;
  my ( $input_directory , $output_directory ) = @ARGV;
  mkdir $output_directory unless -d $output_directory;

  #2. Collect input files.
  my $phased_haps_files = get_phased_haps_files();
  say "Finished collecting phased haps files.  Found " . scalar @$phased_haps_files . " files.";

  #4. Iterate across input files.  Get the chromosome for each. Iterate through chunks in that chromosome, submitting the jobs.
  for my $phased_haps_file ( @$phased_haps_files ) {
    my $chromosome = get_chromosome_from_file_name( $phased_haps_file ); #Automatically dies if this function call fails.
    my $chunk = 0; #Keep track of the current chunk.
    for my $interval ( @{ $CHUNKS->{$chromosome} } ) { #Iterate across the chunks for this chromosome.
      $chunk++; #Name for the current chunk.
      my $e_file_name = "chr${chromosome}.chunk${chunk}.e"; #File to capture STDERR.
      my $o_file_name = "chr${chromosome}.chunk${chunk}.o"; #File to capture STDOUT.
      my $output_file_name = "${output_directory}/${chromosome}.chunk${chunk}.allele_probs";
      my $job_command = "bsub -e $e_file_name -o $o_file_name  ";
      $job_command .= '-M 24000 -R"rusage[mem=24000]" -q moore_normal impute2 ';
      $job_command .= "-known_haps_g $phased_haps_file ";
      $job_command .= "-m ~/data/1000GP_Phase3/genetic_map_${chromosome}_combined_b37.txt -h ~/data/1000GP_Phase3/1000GP_Phase3_${chromosome}.hap.gz -l ~/data/1000GP_Phase3/1000GP_Phase3_${chromosome}.legend.gz ";
      $job_command .= "-Ne 20000 -int $interval->[0] $interval->[1] -o $output_file_name -seed 777 -o_gz";
      unless ( -f $output_file_name ) { #Don't overwrite.
	  print `$job_command`; #Fire away!
      }
    }
  }
}

main();
